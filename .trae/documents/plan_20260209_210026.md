# Migration to Modern Stack Plan

This plan outlines the steps to upgrade the application to a modern stack using **Vercel AI SDK**, **Zustand**, **TanStack Query**, **Zod + React Hook Form**, and **Playwright**.

## Phase 1: Dependencies & Setup
1.  **Install Packages**: Install `ai`, `@ai-sdk/google`, `zustand`, `@tanstack/react-query`, `zod`, `react-hook-form`, and `@playwright/test`.
2.  **Configure Providers**: Wrap the application in `QueryClientProvider` within `Providers.tsx`.

## Phase 2: Global State Management (Zustand)
1.  **Create Stores**:
    -   `useSettingsStore`: Manage app-wide settings (model selection, "Deep Thinking" mode).
    -   `useAuthStore`: Manage user session state (replacing manual `useState` in components).
2.  **Refactor Components**: Update `ChatInterface` and `ModelSelector` to read/write from these stores instead of local state or prop drilling.

## Phase 3: Data Fetching (TanStack Query)
1.  **Refactor Model Fetching**: Replace the `useEffect` fetch in `ModelSelector.tsx` with `useQuery`. This adds caching and handles loading states automatically.
2.  **Refactor History Loading**: Replace the complex Supabase history loading effect in `ChatInterface.tsx` with a `useQuery` hook that fetches chat history.

## Phase 4: AI SDK Integration (Vercel AI SDK)
1.  **Update API Route**: Rewrite `app/api/chat/route.ts` to use `streamText` from the `ai` SDK. This enables streaming responses and simplifies the backend logic.
2.  **Update Frontend**: Refactor `ChatInterface.tsx` to use the `useChat` hook.
    -   Replace manual `fetch` and message appending logic with `useChat`'s `append` and `messages`.
    -   Integrate `useChat` with the Supabase history (initial messages).

## Phase 5: Form Validation (Zod + React Hook Form)
1.  **Define Schemas**: Create Zod schemas for the Login form (if applicable) and Chat input.
2.  **Refactor Forms**:
    -   Convert the Login page to use `useForm` with Zod resolver.
    -   (Optional) Wrap the Chat Input in a form for better validation (e.g., file attachment limits), though `useChat` handles the text input mostly.

## Phase 6: End-to-End Testing (Playwright)
1.  **Initialize Playwright**: Run the setup command.
2.  **Create Tests**:
    -   **Smoke Test**: Verify the app loads.
    -   **Chat Flow**: Simulate a user typing a message and receiving a response (mocked).
    -   **Model Selection**: Verify changing models works.

## Execution Order
I will execute these phases sequentially, verifying functionality after each major change to ensure no regressions. Phase 4 (AI SDK) is the most significant change and will be done after the state and data fetching foundations are solid.
